<!--ä»»åŠ¡ç®¡ç†é¡µé¢ - ä»»åŠ¡å¢åˆ æ”¹æŸ¥ç•Œé¢-->
<view class="tasks-page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-navbar" style="padding-top: {{statusBarHeight}}px; height: {{navBarHeight}}px;">
    <view class="navbar-content">
      <text class="navbar-title">ä»»åŠ¡ç®¡ç†</text>
    </view>
  </view>

  <!-- ä»»åŠ¡ç®¡ç†ä¸»ä½“åŒºåŸŸ -->
  <scroll-view class="tasks-container" style="margin-top: {{navBarHeight + statusBarHeight}}px; height: calc(100vh - {{navBarHeight + statusBarHeight}}px);" scroll-y="true">
    <!-- ä»»åŠ¡ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-card">
      <view class="stats-item">
        <text class="stats-number">{{tasks.length}}</text>
        <text class="stats-label">æ€»ä»»åŠ¡</text>
      </view>
      <view class="stats-item">
        <text class="stats-number easy-color">{{easyTasksCount}}</text>
        <text class="stats-label">ç®€å•</text>
      </view>
      <view class="stats-item">
        <text class="stats-number medium-color">{{mediumTasksCount}}</text>
        <text class="stats-label">ä¸­ç­‰</text>
      </view>
      <view class="stats-item">
        <text class="stats-number hard-color">{{hardTasksCount}}</text>
        <text class="stats-label">å›°éš¾</text>
      </view>
    </view>

    <!-- ä»»åŠ¡åˆ—è¡¨ -->
    <view class="tasks-section">
      <view class="section-header">
        <text class="section-title">æˆ‘çš„ä»»åŠ¡</text>
        <text class="section-subtitle">é•¿æŒ‰ä»»åŠ¡å¯è¿›è¡Œç¼–è¾‘æˆ–åˆ é™¤</text>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{isEmpty}}">
        <image class="empty-image" src="/images/empty-tasks.svg" mode="aspectFit" />
        <text class="empty-title">è¿˜æ²¡æœ‰ä»»åŠ¡</text>
        <text class="empty-subtitle">ç‚¹å‡»å³ä¸Šè§’ + å·æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡å§</text>
        <button class="btn btn-primary" bindtap="showAddTaskModal">æ·»åŠ ä»»åŠ¡</button>
      </view>

      <!-- ä»»åŠ¡åˆ—è¡¨ -->
      <view class="tasks-list" wx:else>
        <view 
          wx:for="{{tasks}}" 
          wx:key="id"
          class="task-card"
          bindlongpress="showTaskActions"
          data-task-id="{{item.id}}"
        >
          <view class="task-header">
            <view class="task-info">
              <view class="task-title-row">
                <text class="task-name">{{item.name}}</text>
                <text class="task-date">{{item.createTime}}</text>
              </view>
              <view class="difficulty-tag difficulty-{{item.difficulty}}">
                {{item.difficultyText}}
              </view>
            </view>
            <view class="task-score">+{{item.score}}åˆ†</view>
          </view>
          
          <text class="task-description" wx:if="{{item.description}}">{{item.description}}</text>
          
          <view class="task-meta">
            <view class="task-repeat" wx:if="{{item.repeatType && item.repeatType !== 'once'}}">
              <text class="repeat-label">{{item.repeatText}}</text>
            </view>
          </view>
          
          <view class="task-footer">
            <view class="task-actions">
              <button 
                class="btn-action btn-edit" 
                bindtap="editTask" 
                data-task-id="{{item.id}}"
              >
                ç¼–è¾‘
              </button>
              <button 
                class="btn-action btn-delete" 
                bindtap="deleteTask" 
                data-task-id="{{item.id}}"
              >
                åˆ é™¤
              </button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ·»åŠ ä»»åŠ¡æŒ‰é’®ï¼ˆæµ®åŠ¨ï¼‰ -->
    <view class="fab" bindtap="showAddTaskModal" wx:if="{{hasItems}}">
      <text class="fab-icon">+</text>
    </view>
  </scroll-view>

  <!-- æ·»åŠ /ç¼–è¾‘ä»»åŠ¡æ¨¡æ€æ¡† -->
  <view class="task-modal {{showTaskModal ? 'show' : ''}}" catchtap="hideTaskModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">{{isEditMode ? 'ç¼–è¾‘ä»»åŠ¡' : 'æ·»åŠ ä»»åŠ¡'}}</text>
      </view>
      
      <view class="modal-body">
        <form bindsubmit="submitTask">
          <!-- ä»»åŠ¡åç§° -->
          <view class="form-group">
            <label class="form-label">ä»»åŠ¡åç§°</label>
            <input 
              class="form-input" 
              type="text" 
              placeholder="è¯·è¾“å…¥ä»»åŠ¡åç§°" 
              value="{{taskForm.name}}"
              bindinput="onTaskNameInput"
              maxlength="20"
            />
          </view>
          
          <!-- ä»»åŠ¡æè¿° -->
          <view class="form-group">
            <label class="form-label">ä»»åŠ¡æè¿°</label>
            <textarea 
              class="form-textarea" 
              placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰" 
              value="{{taskForm.description}}"
              bindinput="onTaskDescInput"
              maxlength="100"
            ></textarea>
          </view>
          
          <!-- ä»»åŠ¡å¾ªç¯è®¾ç½® -->
          <view class="form-group">
            <label class="form-label">å¾ªç¯è®¾ç½®</label>
            <view class="repeat-options">
              <view 
                wx:for="{{repeatOptions}}" 
                wx:key="value"
                class="repeat-option {{taskForm.repeatType === item.value ? 'selected' : ''}}"
                bindtap="selectRepeatType"
                data-repeat="{{item.value}}"
              >
                <text class="repeat-icon">{{item.icon}}</text>
                <text class="repeat-name">{{item.name}}</text>
              </view>
            </view>
          </view>

          <!-- éš¾åº¦é€‰æ‹© -->
          <view class="form-group">
            <label class="form-label">ä»»åŠ¡éš¾åº¦</label>
            <view class="difficulty-options">
              <view 
                wx:for="{{difficultyOptions}}" 
                wx:key="value"
                class="difficulty-option {{taskForm.difficulty === item.value ? 'selected' : ''}}"
                bindtap="selectDifficulty"
                data-difficulty="{{item.value}}"
              >
                <view class="difficulty-color" style="background-color: {{item.color}};"></view>
                <view class="difficulty-info">
                  <text class="difficulty-name">{{item.name}}</text>
                  <text class="difficulty-score">+{{item.score}}åˆ†</text>
                </view>
              </view>
            </view>
          </view>
          
          <!-- æäº¤æŒ‰é’® -->
          <view class="form-actions">
            <button class="btn btn-secondary" bindtap="hideTaskModal">å–æ¶ˆ</button>
            <button 
              class="btn btn-primary" 
              form-type="submit"
              disabled="{{!canSubmit}}"
            >
              {{isEditMode ? 'ä¿å­˜' : 'æ·»åŠ '}}
            </button>
          </view>
        </form>
      </view>
    </view>
  </view>

  <!-- ä»»åŠ¡æ“ä½œèœå• -->
  <view class="action-sheet {{showActionSheet ? 'show' : ''}}" catchtap="hideActionSheet">
    <view class="action-sheet-content" catchtap="stopPropagation">
      <view class="action-sheet-header">
        <text class="action-sheet-title">é€‰æ‹©æ“ä½œ</text>
      </view>
      <view class="action-sheet-body">
        <button class="action-item" bindtap="editTaskFromSheet">
          <text class="action-icon">âœï¸</text>
          <text class="action-text">ç¼–è¾‘ä»»åŠ¡</text>
        </button>
        <button class="action-item danger" bindtap="deleteTaskFromSheet">
          <text class="action-icon">ğŸ—‘ï¸</text>
          <text class="action-text">åˆ é™¤ä»»åŠ¡</text>
        </button>
      </view>
      <view class="action-sheet-footer">
        <button class="btn btn-secondary" bindtap="hideActionSheet">å–æ¶ˆ</button>
      </view>
    </view>
  </view>
</view>