<!--è‡ªå¾‹æ‰“å¡é¡µé¢ - æ ¸å¿ƒæ‰“å¡ç•Œé¢-->
<view class="checkin-page">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-navbar" style="padding-top: {{statusBarHeight}}px; height: {{navBarHeight}}px;">
    <view class="navbar-content">
      <text class="navbar-title">æ¯æ—¥æ‰“å¡</text>
      <view class="navbar-date">{{currentDate}}</view>
    </view>
  </view>

  <!-- æ‰“å¡ä¸»ä½“åŒºåŸŸ -->
  <scroll-view class="checkin-container" style="margin-top: {{navBarHeight + statusBarHeight}}px; height: calc(100vh - {{navBarHeight + statusBarHeight}}px);" scroll-y="true">
    <!-- Canvas æ‰“å¡åŒºåŸŸ -->
    <view class="canvas-container">
      <canvas 
      type="2d" 
      id="checkinCanvas" 
      class="checkin-canvas" 
      bindtouchstart="onCanvasTouchStart" 
      bindtouchend="onCanvasTouchEnd" 
      bindtap="onCanvasTap"
      bindlongtap="onCanvasLongTap"
    ></canvas>
      
      <!-- åè¨€æ–‡å­—è¦†ç›–å±‚ -->
      <view class="quote-overlay" wx:if="{{allTasksCompleted}}">
        <view class="quote-content">
          <text class="quote-text">"{{todayQuote.text}}"</text>
          <text class="quote-author">â€” {{todayQuote.author}}</text>
        </view>
      </view>
    </view>

    <!-- æ‰“å¡çŠ¶æ€ä¿¡æ¯ -->
    <view class="checkin-info">
      <view class="info-card">
        <view class="info-item">
          <text class="info-label">ä»Šæ—¥å¾—åˆ†</text>
          <text class="info-value score">{{todayScore}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">å®Œæˆä»»åŠ¡</text>
          <text class="info-value">{{completedTasks}}/{{totalTasks}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">å®Œæˆç‡</text>
          <text class="info-value">{{completionRate}}%</text>
        </view>
      </view>
      
      <!-- è°ƒè¯•æ§åˆ¶ -->
      <view class="debug-controls" wx:if="{{debugMode}}">
        <button class="debug-btn" size="mini" bindtap="toggleRenderer">
          {{useSimpleRenderer ? 'åˆ‡æ¢åˆ°å¤æ‚æ¨¡å¼' : 'åˆ‡æ¢åˆ°ç®€å•æ¨¡å¼'}}
        </button>
        <text class="debug-info">å½“å‰: {{useSimpleRenderer ? 'ç®€å•ç½‘æ ¼' : 'æ³°æ£®å¤šè¾¹å½¢'}}</text>
      </view>
    </view>

    <!-- ä»»åŠ¡åˆ—è¡¨ -->
    <view class="tasks-section">
      <view class="section-header">
        <text class="section-title">ä»Šæ—¥ä»»åŠ¡</text>
        <text class="section-subtitle">åŒå‡»è‰²å—å®Œæˆä»»åŠ¡</text>
      </view>
      
      <view class="tasks-list">
        <view 
          wx:for="{{todayTasks}}" 
          wx:key="id"
          class="task-item {{item.completed ? 'completed' : ''}}"
        >
          <view class="task-info">
            <view class="task-header">
              <text class="task-name">{{item.name}}</text>
              <view class="difficulty-tag difficulty-{{item.difficulty}}">
                {{item.difficultyText}}
              </view>
            </view>
            <text class="task-description" wx:if="{{item.description}}">{{item.description}}</text>
          </view>
          
          <view class="task-status">
            <view class="task-score">+{{item.score}}</view>
            <view class="task-check {{item.completed ? 'checked' : ''}}">
              <text class="check-icon">âœ“</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å®Œæˆæç¤º -->
    <view class="completion-modal {{showCompletionModal ? 'show' : ''}}" catchtap="hideCompletionModal">
      <view class="modal-content" catchtap="stopPropagation">
        <view class="modal-header">
          <text class="modal-title">ğŸ‰ Perfect Day!</text>
        </view>
        <view class="modal-body">
          <text class="modal-text">æ­å–œä½ å®Œæˆäº†ä»Šå¤©çš„æ‰€æœ‰ä»»åŠ¡ï¼</text>
          <text class="modal-score">ä»Šæ—¥å¾—åˆ†ï¼š{{todayScore}} åˆ†</text>
        </view>
        <view class="modal-actions">
          <button class="btn btn-primary" bindtap="shareCheckinResult">åˆ†äº«æˆæœ</button>
          <button class="btn btn-secondary" bindtap="hideCompletionModal">ç»§ç»­åŠªåŠ›</button>
        </view>
      </view>
    </view>
  </scroll-view>
</view>